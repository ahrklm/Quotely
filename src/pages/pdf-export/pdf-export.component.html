
@if (quote(); as q) {
  <div class="bg-slate-100 min-h-screen p-4 sm:p-8 md:p-12 print-container">
    <!-- Top bar -->
    <header class="max-w-5xl mx-auto flex justify-between items-center mb-4 no-print">
        <p class="text-sm font-bold text-slate-400 uppercase tracking-wider">CONFIDENTIAL / FOR INTERNAL REVIEW ONLY</p>
        <button (click)="saveAsPdf()" class="bg-white text-slate-700 font-bold py-2 px-4 rounded-lg border border-slate-300 hover:bg-slate-100 transition-colors flex items-center gap-2 shadow-sm">
            <div [innerHTML]="iconService.getIcon('Download')"></div>
            <span>Save as PDF</span>
        </button>
    </header>

    <!-- Main content card -->
    <div class="max-w-5xl mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
        <!-- Header part of the card -->
        <div class="afkl-gradient text-white p-12 rounded-t-2xl">
            <div class="flex justify-between items-start">
                <div>
                    <div class="bg-white/10 text-white text-xs font-bold uppercase tracking-wider px-3 py-1.5 rounded-full mb-4">
                        PROPOSAL {{ q.requestDate | date:'yyyy-MM-dd' }}
                    </div>
                    <h1 class="text-5xl font-bold tracking-tight">Project Quote: {{ q.title }}</h1>
                    <p class="text-lg font-medium text-white/80 mt-2 max-w-lg">{{ q.description }}</p>
                </div>
                <div class="text-right shrink-0 ml-8">
                    <img [ngSrc]="AFKL_LOGO_URL" alt="Air France-KLM Group" class="h-[32px] brightness-0 invert ml-auto" width="164" height="32" />
                    <p class="text-xs font-bold uppercase tracking-wider mt-4">GENERATED FOR</p>
                    <p class="text-sm font-medium">{{ contactName() }}</p>
                </div>
            </div>
        </div>

        <!-- KPI Section -->
        <div class="p-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="bg-[#0800B9] text-white p-6 rounded-2xl">
                <p class="text-xs font-bold uppercase opacity-80">Total Investment</p>
                <p class="text-4xl font-bold tracking-tight mt-1">{{ q.totalPrice | currency:'EUR':'symbol' }}</p>
            </div>
            <div class="bg-white p-6 rounded-2xl border border-slate-200">
                <p class="text-xs font-bold uppercase text-slate-500">Estimated Sprints</p>
                <p class="text-4xl font-bold tracking-tight text-slate-800 mt-1">0</p>
            </div>
            <div class="bg-white p-6 rounded-2xl border border-slate-200">
                <p class="text-xs font-bold uppercase text-slate-500">Total Story Points</p>
                <p class="text-4xl font-bold tracking-tight text-slate-800 mt-1">{{ q.totalPoints }}</p>
            </div>
            <div class="bg-white p-6 rounded-2xl border border-slate-200">
                <p class="text-xs font-bold uppercase text-slate-500">Base Hourly Rate</p>
                <p class="text-4xl font-bold tracking-tight text-slate-800 mt-1">{{ q.pricePerHour | currency:'EUR':'symbol' }}</p>
            </div>
        </div>
        
        <!-- Divider and Title -->
        <div class="px-10 pb-10">
            <div class="flex items-center gap-3 mt-4">
                <div class="w-1 h-6 bg-[#0800B9] rounded-full"></div>
                <h2 class="text-2xl font-bold text-[#0800B9]">Scope & Deliverables Breakdown</h2>
            </div>
            
            <!-- Deliverables Tables -->
            <div class="space-y-8 mt-6">
              @for (section of sectionsWithItems(); track section.id) {
                <div>
                  <h3 class="text-lg font-bold text-slate-700 mb-3">{{ section.title }}</h3>
                  <div class="rounded-lg border border-slate-200 overflow-hidden">
                    <table class="w-full text-sm">
                      <thead>
                        <tr class="bg-slate-50 text-[10px] font-bold uppercase tracking-widest text-slate-400">
                          <th class="px-4 py-2 text-left">Deliverable</th>
                          <th class="px-4 py-2 text-right">Effort (Hours)</th>
                        </tr>
                      </thead>
                      <tbody>
                        @for (item of section.items; track item.id) {
                           <tr class="border-t border-slate-100">
                             <td class="px-4 py-3">
                               <p class="font-medium text-slate-800">{{ item.title }}</p>
                               @if (item.description) {
                                <p class="text-xs text-slate-500">{{ item.description }}</p>
                               }
                             </td>
                             <td class="px-4 py-3 text-right font-bold text-slate-700">{{ item.hours }}h</td>
                           </tr>
                        }
                      </tbody>
                    </table>
                  </div>
                </div>
              } @empty {
                <div class="text-center py-10 text-slate-500 border-2 border-dashed border-slate-200 rounded-lg">
                    <p>No deliverables have been added to this quote yet.</p>
                </div>
              }
            </div>

            <!-- Total Effort Footer -->
            <div class="mt-10 bg-slate-100 rounded-lg p-6 flex justify-between items-center">
                <p class="text-lg font-bold text-slate-600 uppercase">Total Estimated Effort</p>
                <div>
                    <p class="text-3xl font-bold text-[#0800B9] text-right">{{ q.totalHours }} hours</p>
                    <p class="text-xs text-slate-400 text-right">Â± 10% MARGIN APPLIED</p>
                </div>
            </div>
        </div>
    </div>
  </div>
} @else {
    <div class="flex items-center justify-center h-screen">
      <div class="w-12 h-12 border-4 border-slate-300 border-t-blue-600 rounded-full animate-spin"></div>
    </div>
}
